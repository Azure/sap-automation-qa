# DONOT CHANGE
# Test group variables
# Description: This contains the test groups and test cases that will be executed by the quality assurance playbook

# Map of functional type name and actual values
sap_functional_test_type_map:
  - name:                           "DatabaseHighAvailability"
    value:                          HA_DB
  - name:                           "CentralServicesHighAvailability"
    value:                          HA_SCS

test_groups:
  - name:                           HA_DB_HANA
    test_cases:
      - name:                       HA Parameters Validation
        task_name:                  ha-config
        description:                This validates the HA configuration

      - name:                       HA Functional Test- Resource Migration
        task_name:                  resource-migration
        description:                This runs a functional test for resource migration

      # - name:                       HA Functional Test- Primary Node Crash
      #   task_name:                  primary-node-crash
      #   description:                This runs a functional test for primary node crash

  - name:                           HA_SCS
    test_cases:
      - name:                       ha-config
        description:                This validates the HA configuration

  - name:                           HA_SCS
    test_cases:
      - name:                       ha-config
        description:                This validates the HA configuration

commands:
  - name:                           automated_register_cmd
    SUSE:                           "set -o pipefail; crm configure show | grep AUTOMATED_REGISTER=true | awk '{print $6}'"
    REDHAT:                         "set -o pipefail; pcs config show | grep AUTOMATED_REGISTER=true | awk '{print $1}'"

  - name:                           resource_cleanup_cmd
    SUSE:                           "crm resource cleanup"
    REDHAT:                         "pcs resource cleanup"

  - name:                           specific_resource_cleanup_cmd
    SUSE:                           "crm resource cleanup rsc_SAPHana_{{ db_sid | upper }}_HDB{{ db_instance_number }}"
    REDHAT:                         "pcs resource cleanup rsc_SAPHana_{{ db_sid | upper }}_HDB{{ db_instance_number }}"

  - name:                           resource_migration_cmd
    SUSE:                           "crm resource move msl_SAPHana_{{ db_sid | upper }}_HDB{{ db_instance_number }} {{ cluster_status_pre.secondary_node }} force"
    REDHAT:                         "pcs resource move SAPHana_{{ db_sid | upper }}_{{ db_instance_number  }}-clone --master"
